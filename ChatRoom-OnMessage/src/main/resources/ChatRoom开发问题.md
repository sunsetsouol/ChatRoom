# ChatRoom开发问题

## RabbitMQ异常

rabbitListener没有接收到消息，debug发现covert方法已经被调用，但是没有收到ack的回调

![image-20240515191132006](https://sunsetsouol.oss-cn-guangzhou.aliyuncs.com/pic/202405151911046.png)

交换机一直没有收到消息，而且没有报错，说明消息没有发出去

![image-20240515191045058](https://sunsetsouol.oss-cn-guangzhou.aliyuncs.com/pic/202405151912976.png)

通过测试发现，covert一直被阻塞，没有发出去，但是之前一直都能发，推断是mq出现了问题，

通过日志和服务器排查发现是服务器硬盘空间满了



## 大文本和媒体文件传输阻塞问题

实测发现ws在处理消息的时候，只有在处理完上一条消息后才会处理下一条消息，当ws从没有消息到有消息接收，会从线程池选一个线程处理，如果上一个消息没有处理完又接收到一个消息，ws不回再调用另一个线程处理新来的消息，而是等待上一个消息处理完后，线程直接处理下一个消息，如果消息被消费完没有新消息，线程回归线程池

这里就出现一个问题，在接收大文本或者媒体文件的时候，一直阻塞怎么办

解决方法，分段上传



## 服务注册到nacos的ip是内网的ip，连接后发送不了信息



# 空消息的填充

网络问题导致前面的消息一直没有成功发送，但是后面的消息已经成功发送了，前面的消息失败一定次数后就会判定发送失败，那么服务器一直没有收到前面的消息，后面的消息就会一直放在缓存区发不出去





# 消息存储score精度问题

背景：我们将信息存到收件箱采用的是zset数据类型，score是全局唯一id，每次只需要根据上次的全局id找到score比他大的消息即可，但是score是double类型的数据，全局id是long类型的数据，在redis中读取这个score的double时会

根据全局消息id找到消息